name: CI

on:
  push:
    branches: [ "*" ]
  pull_request:
    branches: [ "*" ]

jobs:
  Build-and-Tests:
    name: Build and Test
    runs-on: ubuntu-18.04
    steps:
    - uses: actions/checkout@v2
    - name: Setup .NET Core
      uses: actions/setup-dotnet@v1
      with:
        dotnet-version: '6.0.x'
    - name: Add Nuget
      run: |
        cd src
        for proj in $(dotnet sln list | grep Tests)        
        do
          dotnet add "$proj" package JunitXml.TestLogger || true
          dotnet add "$proj" package altcover || true	
        done
    - name: Test
      run: |	  
        cd src	
        dotnet test --logger "junit;LogFileName=Report.xml"
    - name: Publish Unit Test Results
      uses: docker://ghcr.io/enricomi/publish-unit-test-result-action:v1
      if: ${{ github.ref == 'refs/heads/main' && always() }}
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        files: src/**/Report.xml
